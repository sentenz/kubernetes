# Local development overlay for Dependency-Track

The Kustomize overlay configures Dependency-Track for local development using the bundled self-signed TLS certificate and Traefik.

What is already configured
- Ingress resources for the API and frontend are present in `ingress.yaml` and
  point to:
    - api.dependency-track.localhost
    - dependency-track.localhost
- A TLS secret named `dependency-track-tls` is generated by the overlay's
  `secretGenerator` from the included cert files (`dependency-track.localhost+1.pem` and
  `dependency-track.localhost+1-key.pem`).
- Frontend is configured to use `https://api.dependency-track.localhost` via
  the base chart values.

Steps to run locally
1. Ensure Traefik from `manifests/base/traefik` is applied in the cluster (the
   overlay pulls the base traefik chart). Traefik is configured to listen on
   ports 80/443 for this overlay.

2. How to reach the services from your workstation

- If your Kubernetes node is the same machine where you run the browser (single-node minikube/kind), add hosts entries (requires root):

  127.0.0.1 dependency-track.localhost api.dependency-track.localhost

  This makes the two hostnames resolve to localhost so Traefik can route them.

- If your cluster runs on a remote machine, find the node IP and point the hostnames to that address instead:

  # find node external/internal IP
  kubectl --kubeconfig=examples/config/kubeconfig.yaml get nodes -o wide

  Then add an /etc/hosts entry using the node's IP instead of 127.0.0.1.

- If you prefer a quick local tunnel without editing /etc/hosts, port-forward Traefik's HTTPS port to localhost and access via hosts file:

  kubectl --kubeconfig=examples/config/kubeconfig.yaml -n traefik port-forward svc/traefik 8443:443 &

  And in /etc/hosts add:

  127.0.0.1 dependency-track.localhost api.dependency-track.localhost

  Then access https://dependency-track.localhost:8443/ (or use curl -k against that port).

3. Apply the overlay using kustomize:

  kubectl apply -k manifests/overlays/dev/dependency-track

4. Verify and quick checks

- Check resources:

```bash
kubectl --kubeconfig=examples/config/kubeconfig.yaml -n dependency-track get secret dependency-track-tls
kubectl --kubeconfig=examples/config/kubeconfig.yaml -n dependency-track get ingress
kubectl --kubeconfig=examples/config/kubeconfig.yaml -n dependency-track get pods
```

- Quick HTTP checks (skip TLS verification)

```bash
curl -k https://dependency-track.localhost/ -I
curl -k https://api.dependency-track.localhost/ -I
```

Notes and troubleshooting
- The included certificate is self-signed. Your browser will warn about the cert
  unless you explicitly trust it. For API calls from scripts, you may need to
  disable certificate verification or add the cert to your trust store.
- If ports 80/443 are already in use on the host, Traefik may fail to start. In
  that case, stop the conflicting service or adapt the Traefik chart arguments
  in `manifests/base/traefik/values.yaml`.
- Important: hostNetwork warning

- This overlay enables `hostNetwork: true` for the Traefik pod so it can bind
  directly to the host network on ports 80/443. This is safe for a local
  development node (k3s/minikube/kind) that runs on the same machine where
  you browse the services. Do NOT enable hostNetwork for remote clusters â€” it
  exposes Traefik on node network interfaces and can conflict with host
  services or create unwanted exposure.

- If you want to use different hostnames, update `ingress.yaml`, the TLS
  secret filenames in `kustomization.yaml`, and the frontend `apiBaseUrl` in
  `manifests/base/dependency-track/values.yaml` (or patch the rendered
  deployment via kustomize).
